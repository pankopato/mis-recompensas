<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Club de Recompensas Pro</title>
    <style>
        :root { --primary: #6366f1; --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --accent: #fbbf24; }
        body { font-family: sans-serif; background: var(--bg); display: flex; justify-content: center; padding: 20px; color: var(--text); }
        .container { width: 100%; max-width: 400px; text-align: center; }
        .card { background: var(--card); border-radius: 24px; padding: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 20px; }
        .stamp { aspect-ratio: 1/1; border: 2px dashed #cbd5e1; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #94a3b8; }
        .stamp.active { background: var(--primary); color: white; border-style: solid; border-color: var(--primary); }
        .stamp.reward { border-color: var(--accent); color: var(--accent); }
        .stamp.reward.active { background: var(--accent); color: white; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; display: inline-block; margin: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #msg { font-weight: bold; margin: 10px 0; }
    </style>
</head>
<body>

<div class="container">
    <h1>üéÅ Mi Club</h1>
    <div class="card">
        <div id="loader" class="loader"></div>
        <p id="msg">Cargando tus sellos...</p>
        
        <div class="grid" id="grid">
            <div class="stamp">1</div><div class="stamp">2</div><div class="stamp">3</div>
            <div class="stamp">4</div><div class="stamp">5</div><div class="stamp">6</div>
            <div class="stamp">7</div><div class="stamp">8</div><div class="stamp reward">üéÅ</div>
        </div>
    </div>
    <p style="font-size: 0.8rem; color: #64748b; margin-top: 20px;">Los sellos se actualizan autom√°ticamente al realizar tu compra.</p>
</div>

<script>
    // --- CONFIGURACI√ìN ---
    // PEGA AQU√ç EL LINK CSV QUE COPIASTE DE GOOGLE SHEETS
    const URL_SHEETS = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRbXL1Y_NsoPSaYsTJ5OJCQjFemmQTj94AkZku0bxSi4oKvbpJ9KOHwkXE0mgXxmLZA40uwv4rkV1WG/pubhtml";
    
    // Obtener el ID del cliente de la URL (ejemplo: mipagina.com/?id=juan77)
    const params = new URLSearchParams(window.location.search);
    const clienteId = params.get('id');

    async function consultarSellos() {
        if (!clienteId) {
            document.getElementById('msg').innerText = "Error: Enlace de cliente no v√°lido.";
            document.getElementById('loader').style.display = 'none';
            return;
        }

        try {
            // Agregamos un n√∫mero aleatorio al final para evitar que el navegador guarde una copia vieja (cach√©)
            const respuesta = await fetch(URL_SHEETS + "&cache=" + Math.random());
            const data = await respuesta.text();
            const filas = data.split("\n");
            
            let sellosEncontrados = 0;
            let usuarioExiste = false;

            filas.forEach(fila => {
                const columnas = fila.split(",");
                if (columnas[0].trim().toLowerCase() === clienteId.toLowerCase()) {
                    sellosEncontrados = parseInt(columnas[1]);
                    usuarioExiste = true;
                }
            });

            if (usuarioExiste) {
                dibujarSellos(sellosEncontrados);
                document.getElementById('msg').innerText = `¬°Hola! Tienes ${sellosEncontrados} de 9 sellos.`;
            } else {
                document.getElementById('msg').innerText = "Cliente no registrado.";
            }
        } catch (e) {
            document.getElementById('msg').innerText = "Error de conexi√≥n.";
        }
        document.getElementById('loader').style.display = 'none';
    }

    function dibujarSellos(num) {
        const stamps = document.querySelectorAll('.stamp');
        stamps.forEach((s, i) => {
            if (i < num) s.classList.add('active');
        });
    }

    consultarSellos();
</script>
</body>
</html>

</html>

